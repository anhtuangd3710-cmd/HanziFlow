(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[851],{17237:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var n=s(95155);s(12115);let r=()=>(0,n.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"})},20063:(e,t,s)=>{"use strict";var n=s(47260);s.o(n,"useParams")&&s.d(t,{useParams:function(){return n.useParams}}),s.o(n,"usePathname")&&s.d(t,{usePathname:function(){return n.usePathname}}),s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}}),s.o(n,"useSearchParams")&&s.d(t,{useSearchParams:function(){return n.useSearchParams}})},30554:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var n=s(95155),r=s(12115),i=s(17237),a=s(20063),l=s(43853),u=s(37621);let c=e=>{let t={a:{1:"ā",2:"\xe1",3:"ǎ",4:"\xe0",5:"a"},e:{1:"ē",2:"\xe9",3:"ě",4:"\xe8",5:"e"},i:{1:"ī",2:"\xed",3:"ǐ",4:"\xec",5:"i"},o:{1:"ō",2:"\xf3",3:"ǒ",4:"\xf2",5:"o"},u:{1:"ū",2:"\xfa",3:"ǔ",4:"\xf9",5:"u"},ü:{1:"ǖ",2:"ǘ",3:"ǚ",4:"ǜ",5:"\xfc"},v:{1:"ǖ",2:"ǘ",3:"ǚ",4:"ǜ",5:"\xfc"}};return e.toLowerCase().split(/\s+/).map(e=>(e.match(/([a-züv]+[1-5]?)/g)||[e]).map(e=>{var s;let n=e.match(/^([a-züv]+)([1-5])$/);if(!n)return e;let[,r,i]=n,a=-1;if(r.includes("a")?a=r.indexOf("a"):r.includes("o")?a=r.indexOf("o"):r.includes("e")?a=r.indexOf("e"):r.includes("iu")?a=r.indexOf("u"):r.includes("i")?a=r.indexOf("i"):r.includes("u")?a=r.indexOf("u"):r.includes("\xfc")?a=r.indexOf("\xfc"):r.includes("v")&&(a=r.indexOf("v")),-1===a)return e;let l="v"===r[a]?"v":r[a],u=(null==(s=t[l])?void 0:s[i])||l;return r.substring(0,a)+u+r.substring(a+1)}).join("")).join(" ")};function o(e){return[...e].sort(()=>Math.random()-.5)}let d=()=>{var e;let{setId:t}=(0,a.useParams)(),s=(0,a.useRouter)(),d=(0,a.useSearchParams)(),{questionTypes:m,questionCount:f}={questionTypes:(null==(e=d.get("types"))?void 0:e.split(","))||[],questionCount:parseInt(d.get("questionCount")||"10")},h=(0,r.useContext)(l.B),[x,p]=(0,r.useState)(void 0),[g,v]=(0,r.useState)(!0),[b,j]=(0,r.useState)([]),[w,y]=(0,r.useState)([]),[N,S]=(0,r.useState)(0),[A,C]=(0,r.useState)(""),[P,z]=(0,r.useState)(90),[O,I]=(0,r.useState)(!1),E=(0,r.useRef)(void 0),L=(0,r.useRef)(w);if((0,r.useEffect)(()=>{L.current=w},[w]),!h)return(0,n.jsx)("div",{children:"Loading..."});let{state:R,saveQuizResult:k}=h,_=(0,r.useMemo)(()=>R.vocabSets.find(e=>e._id===t),[R.vocabSets,t]);(0,r.useEffect)(()=>{if(_){p(_),v(!1);return}(async()=>{if(!t){p(null),v(!1);return}v(!0);try{let e=await (0,u.Re)(t);p(e)}catch(e){console.error("Failed to fetch quiz set:",e),p(null)}finally{v(!1)}})()},[t,_]),(0,r.useEffect)(()=>{x&&j(o([...x.items,...x.items,...x.items]).map((e,t)=>{let s=["meaning","hanzi","pinyin"];m&&m.length>0&&(s=s.filter(e=>m.includes(e))),0===s.length&&(s=["meaning","hanzi","pinyin"]);let n=s[t%s.length];switch(n){case"hanzi":{let t=o(x.items.filter(t=>t.id!==e.id)).slice(0,3).map(e=>e.hanzi),s=o([e.hanzi,...t]);return{type:n,vocabItem:e,options:s,correctAnswer:e.hanzi}}case"pinyin":return{type:n,vocabItem:e,options:[],correctAnswer:e.pinyin};default:{let t=o(x.items.filter(t=>t.id!==e.id)).slice(0,3).map(e=>e.meaning),s=o([e.meaning,...t]);return{type:n,vocabItem:e,options:s,correctAnswer:e.meaning}}}}))},[x,m]);let q=(0,r.useCallback)(async()=>{if(O)return;I(!0),E.current&&clearInterval(E.current);let e=L.current,n={score:e.reduce((e,t)=>t.userAnswer?e+ +!!("pinyin"===t.type?c(t.userAnswer).toLowerCase()===t.correctAnswer.toLowerCase():t.userAnswer===t.correctAnswer):e,0),total:e.length,questions:e};t&&await k(t,n),s.push("/set/".concat(t,"/result"))},[O,k,s,t]);(0,r.useEffect)(()=>(b.length>0&&!O&&(E.current=window.setInterval(()=>{z(e=>e<=1?(q(),0):e-1)},1e3)),()=>{E.current&&clearInterval(E.current)}),[b,O,q]);let T=e=>{if(O)return;let t={...b[N],userAnswer:e};y(e=>[...e,t]),S(e=>e+1),C("")};if(g||0===b.length)return(0,n.jsx)("div",{className:"flex justify-center mt-8",children:(0,n.jsx)(i.A,{})});if(!x)return(0,n.jsx)("div",{children:"Set not found."});if(O)return(0,n.jsx)("div",{className:"text-center p-8",children:"Calculating results..."});if(N>=b.length)return q(),(0,n.jsx)("div",{className:"text-center p-8",children:"No more questions! Calculating results..."});let F=b[N],M=w.filter(e=>"pinyin"===e.type?c(e.userAnswer).toLowerCase()===e.correctAnswer.toLowerCase():e.userAnswer===e.correctAnswer).length;return(0,n.jsxs)("div",{className:"max-w-3xl mx-auto p-4 sm:p-6 bg-white rounded-lg shadow-xl",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-purple-600",children:"Lightning Round!"}),(0,n.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,n.jsxs)("div",{className:"text-lg font-semibold",children:["Score: ",(0,n.jsx)("span",{className:"text-green-600",children:M})]}),(0,n.jsxs)("div",{className:"text-lg font-semibold",children:["Time: ",(0,n.jsx)("span",{className:P<10?"text-red-500 animate-pulse":"",children:P}),"s"]})]})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-6",children:(0,n.jsx)("div",{className:"bg-purple-600 h-2.5 rounded-full",style:{width:"".concat(P/90*100,"%")}})}),(0,n.jsxs)("div",{className:"bg-gray-100 p-8 rounded-lg text-center mb-6 min-h-[180px] flex flex-col justify-center",children:[("meaning"===F.type||"pinyin"===F.type)&&(0,n.jsx)("p",{className:"text-6xl font-bold",children:F.vocabItem.hanzi}),"hanzi"===F.type&&(0,n.jsx)("p",{className:"text-4xl font-bold text-center",children:F.vocabItem.meaning})]}),"pinyin"!==F.type?(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:(F.options||[]).map((e,t)=>(0,n.jsx)("button",{onClick:()=>T(e),className:"p-4 text-left font-semibold rounded-lg border-2 bg-white border-gray-300 hover:bg-blue-50 hover:border-blue-400",children:e},t))}):(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault(),T(A)},children:(0,n.jsx)("input",{type:"text",value:A,onChange:e=>C(e.target.value),placeholder:"Type the pinyin and press Enter",autoFocus:!0,className:"w-full p-4 border-2 rounded-lg text-center text-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"})})]})};function m(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,n.jsx)(i.A,{}),(0,n.jsx)("p",{className:"ml-4 text-gray-600",children:"Loading page..."})]}),children:(0,n.jsx)(d,{})})}},71452:(e,t,s)=>{Promise.resolve().then(s.bind(s,30554))}},e=>{e.O(0,[798,853,441,255,358],()=>e(e.s=71452)),_N_E=e.O()}]);