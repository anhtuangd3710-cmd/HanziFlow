"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[853],{12083:(e,a,t)=>{t.d(a,{AU:()=>n,FQ:()=>l,m7:()=>o,r:()=>i});var r=t(12014);let o="API_KEY_FAILURE",s=()=>{let e=localStorage.getItem("gemini_api_key")||"AIzaSyCEWxC0Xjw1kpByT3xyvTWkxcegD3pM3CQ";if(!e)throw console.warn("No API key found. Prompting user."),Error(o);return new r.M4({apiKey:e})},n=e=>{if("speechSynthesis"in window){window.speechSynthesis.cancel();let a=new SpeechSynthesisUtterance(e);a.lang="zh-CN",a.rate=.9,window.speechSynthesis.speak(a)}else alert("Sorry, your browser does not support text-to-speech.")},l=async e=>{let a='Create a simple and clear example sentence in Chinese for a beginner learning the word "'.concat(e.hanzi,'" (pinyin: ').concat(e.pinyin,'), which means "').concat(e.meaning,'". The sentence should use common vocabulary. Provide only the Chinese sentence with its pinyin and the English translation below it, like this:\nChinese sentence (Pinyin)\nEnglish Translation');try{let e=s(),t=await e.models.generateContent({model:"gemini-2.5-flash",contents:a});return t.text?t.text.trim():null}catch(e){if(console.error("Error generating example sentence:",e),e instanceof Error){let a=e.message.toLowerCase();if(a.includes("api key not valid")||a.includes("permission denied")||a.includes("quota")||a.includes("api_key"))throw Error(o)}return alert("Failed to generate an example sentence. The AI model may be temporarily unavailable."),null}},i=async(e,a)=>{let t="Generate a list of ".concat(a,' Chinese vocabulary words related to the topic "').concat(e,'".\nThe words should be suitable for a beginner to intermediate learner.\nFor each word, provide the Hanzi, standard Pinyin with correct tone marks, a concise English meaning, and a simple example sentence in Chinese.\nIMPORTANT: Respond ONLY with a valid JSON array of objects inside a single markdown code block (```json ... ```). Do not include any other text, explanation, or introductory phrases.\nEach object in the array must have these exact keys: "hanzi", "pinyin", "meaning", "exampleSentence".');try{var r;let e=s(),a=await e.models.generateContent({model:"gemini-2.5-flash",contents:t});if(null==(r=a.promptFeedback)?void 0:r.blockReason)throw console.error("AI response was blocked:",a.promptFeedback),Error("The request was blocked for safety reasons: ".concat(a.promptFeedback.blockReasonMessage||a.promptFeedback.blockReason));if(!a.text)throw Error("No response text received from AI model");let o=(e=>{let a=e.match(/```json\s*([\s\S]*?)\s*```/),t=a?a[1]:e;try{return JSON.parse(t.trim())}catch(a){throw console.error("Failed to parse JSON from model response:",a),console.error("Original text from model:",e),Error("Model returned invalid JSON format.")}})(a.text);if(!Array.isArray(o))throw console.error("Parsed JSON is not an array:",o),Error("AI did not return the expected list format.");return o}catch(e){if(console.error("Error generating vocab set:",e),e instanceof Error){let a=e.message.toLowerCase();if(a.includes("api key not valid")||a.includes("permission denied")||a.includes("quota")||a.includes("api_key"))throw Error(o);let t="Failed to generate a vocabulary set with AI. The model may be temporarily unavailable. Please try again later.";e.message.startsWith("Model returned")||e.message.startsWith("AI did not return")?t="Failed to generate a valid vocabulary set with AI. The AI's response was not in the correct format. Please try a different topic or try again later.":e.message.startsWith("The request was blocked")&&(t="AI generation failed: ".concat(e.message,". Please try a different topic.")),alert(t)}else alert("An unknown error occurred while generating the vocabulary set.");return null}}},37621:(e,a,t)=>{t.d(a,{A3:()=>T,A9:()=>g,DY:()=>l,Ee:()=>f,KP:()=>w,Lx:()=>n,QQ:()=>E,Qj:()=>m,Re:()=>d,Uy:()=>c,aC:()=>y,b0:()=>_,cc:()=>p,dE:()=>A,eg:()=>i,hj:()=>S,lR:()=>o,rK:()=>h,uN:()=>u});let r="http://localhost:5001/api";class o extends Error{constructor(e){super(e),this.name="AuthError"}}let s=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=(()=>{let e=localStorage.getItem("hanziflow_user")||sessionStorage.getItem("hanziflow_user");if(e)try{return JSON.parse(e).token||null}catch(e){}return null})(),r={"Content-Type":"application/json",...a.headers||{}};t&&(r.Authorization="Bearer ".concat(t));let s=await fetch(e,{...a,headers:r});if(401===s.status)throw new o("Your session has expired. Please log in again.");if(403===s.status)throw new o("You are not authorized to perform this action.");if(!s.ok)throw Error((await s.json().catch(()=>({message:"Request failed with status ".concat(s.status)}))).message||"An unknown API error occurred.");if(204!==s.status)return s.json()},n=async(e,a)=>{let t=await fetch("".concat(r,"/users/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:a})});if(!t.ok)throw Error((await t.json()).message||"Login failed");return await t.json()},l=async(e,a,t)=>{let o=await fetch("".concat(r,"/users/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:a,password:t})});if(!o.ok)throw Error((await o.json()).message||"Registration failed");return await o.json()},i=async e=>s("".concat(r,"/users/profile"),{method:"PUT",body:JSON.stringify(e)}),c=async(e,a)=>s("".concat(r,"/sets?page=").concat(e,"&limit=").concat(a)),d=async e=>s("".concat(r,"/sets/").concat(e)),y=async e=>{let a=!!e._id;return s(a?"".concat(r,"/sets/").concat(e._id):"".concat(r,"/sets"),{method:a?"PUT":"POST",body:JSON.stringify(e)})},p=async e=>s("".concat(r,"/sets/").concat(e),{method:"DELETE"}),u=async e=>s(e?"".concat(r,"/history?limit=").concat(e):"".concat(r,"/history")),g=async(e,a)=>s("".concat(r,"/history"),{method:"POST",body:JSON.stringify({vocabSet:e,score:a.score,total:a.total,questions:a.questions})}),S=async()=>s("".concat(r,"/history/stats")),h=async(e,a,t)=>{let o=new URLSearchParams({page:String(e),limit:String(a)});return t&&o.append("search",t),s("".concat(r,"/sets/community?").concat(o.toString()))},m=async e=>s("".concat(r,"/sets/community/").concat(e)),E=async e=>s("".concat(r,"/sets/clone/").concat(e),{method:"POST"}),f=async()=>s("".concat(r,"/users/leaderboard")),A=async()=>s("".concat(r,"/admin/stats")),_=async(e,a)=>s("".concat(r,"/admin/users?page=").concat(e,"&limit=").concat(a)),T=async e=>s("".concat(r,"/admin/users/").concat(e),{method:"DELETE"}),w=async()=>s("".concat(r,"/admin/export/users"))},43853:(e,a,t)=>{t.d(a,{AppProvider:()=>y,B:()=>c});var r=t(95155),o=t(12115),s=t(37621),n=t(12083);let l={user:null,isHydrated:!1,vocabSets:[],setsPagination:null,publicSets:[],publicSetsPagination:null,quizHistory:[],profileQuizHistory:null,userStats:null,leaderboard:null,isLoading:!1,isRequestingUserApiKey:!1,adminStats:null,adminUsers:null,adminUsersPagination:null},i=(e,a)=>{switch(a.type){case"LOGIN":return{...e,user:a.payload,isLoading:!1,isHydrated:!0};case"LOGOUT":return{...l,isHydrated:!0};case"HYDRATE":return{...e,user:a.payload,isHydrated:!0};case"UPDATE_USER":if(!e.user)return e;return{...e,user:{...e.user,...a.payload}};case"SET_LOADING":return{...e,isLoading:a.payload};case"SETS_LOADED":return{...e,vocabSets:a.payload.sets,setsPagination:{currentPage:a.payload.page,totalPages:a.payload.pages,totalSets:a.payload.total,limit:6}};case"PUBLIC_SETS_LOADED":return{...e,publicSets:a.payload.sets,publicSetsPagination:{currentPage:a.payload.page,totalPages:a.payload.pages,totalSets:a.payload.total,limit:9},isLoading:!1};case"UPDATE_SET":return{...e,vocabSets:e.vocabSets.map(e=>e._id===a.payload._id?a.payload:e)};case"HISTORY_LOADED":return{...e,quizHistory:a.payload};case"PROFILE_HISTORY_LOADED":return{...e,profileQuizHistory:a.payload,isLoading:!1};case"USER_STATS_LOADED":return{...e,userStats:a.payload};case"LEADERBOARD_LOADED":return{...e,leaderboard:a.payload,isLoading:!1};case"REQUEST_USER_API_KEY":return{...e,isRequestingUserApiKey:a.payload};case"ADMIN_STATS_LOADED":return{...e,adminStats:a.payload,isLoading:!1};case"ADMIN_USERS_LOADED":return{...e,adminUsers:a.payload.users,adminUsersPagination:{currentPage:a.payload.currentPage,totalPages:a.payload.totalPages},isLoading:!1};default:return e}},c=(0,o.createContext)(void 0),d="hanziflow_user",y=e=>{var a,t,y,p,u,g,S;let{children:h}=e,[m,E]=(0,o.useReducer)(i,l);(0,o.useEffect)(()=>{let e=localStorage.getItem(d)||sessionStorage.getItem(d);if(e)try{let a=JSON.parse(e);E({type:"HYDRATE",payload:a})}catch(e){localStorage.removeItem(d),sessionStorage.removeItem(d),E({type:"HYDRATE",payload:null})}else E({type:"HYDRATE",payload:null})},[]);let f=async(e,a,t)=>{E({type:"SET_LOADING",payload:!0});try{let r=await s.Lx(e,a);(t?localStorage:sessionStorage).setItem(d,JSON.stringify(r)),E({type:"LOGIN",payload:r})}catch(e){console.error(e),alert(e.message||"Login failed. Please check your credentials."),E({type:"SET_LOADING",payload:!1})}},A=async(e,a,t)=>{E({type:"SET_LOADING",payload:!0});try{let r=await s.DY(e,a,t);sessionStorage.setItem(d,JSON.stringify(r)),E({type:"LOGIN",payload:r})}catch(e){console.error(e),alert(e.message||"Registration failed. Please try again."),E({type:"SET_LOADING",payload:!1})}},_=(0,o.useCallback)(()=>{localStorage.removeItem(d),sessionStorage.removeItem(d),E({type:"LOGOUT"})},[]),T=(0,o.useCallback)(async e=>{var a;if(null==(a=m.user)?void 0:a.token){E({type:"SET_LOADING",payload:!0});try{let a=await s.Uy(e,6);E({type:"SETS_LOADED",payload:a})}catch(e){console.error("Failed to fetch sets:",e),e instanceof s.lR&&(alert(e.message),_())}finally{E({type:"SET_LOADING",payload:!1})}}},[null==(a=m.user)?void 0:a.token,_]),w=(0,o.useCallback)(async()=>{var e;if(null==(e=m.user)?void 0:e.token){E({type:"SET_LOADING",payload:!0});try{let[,e,a]=await Promise.all([T(1),s.uN(20),s.hj()]);E({type:"HISTORY_LOADED",payload:e}),E({type:"USER_STATS_LOADED",payload:a})}catch(e){console.error("Failed to fetch initial data:",e),e instanceof s.lR&&(alert(e.message),_())}finally{E({type:"SET_LOADING",payload:!1})}}},[null==(t=m.user)?void 0:t.token,_,T]),D=async e=>{if(!m.user)throw Error("User not logged in");E({type:"SET_LOADING",payload:!0});try{let a=await s.aC(e);e._id?E({type:"UPDATE_SET",payload:a}):await T(1);let t=await s.hj();return E({type:"USER_STATS_LOADED",payload:t}),a}catch(e){console.error("Failed to save set:",e),e instanceof s.lR?(alert(e.message),_()):alert(e.message)}finally{E({type:"SET_LOADING",payload:!1})}},O=async e=>{if(!m.user)throw Error("User not logged in");E({type:"SET_LOADING",payload:!0});try{await s.cc(e);let{vocabSets:a,setsPagination:t}=m,r=(null==t?void 0:t.currentPage)||1;1===a.length&&r>1&&(r-=1),await T(r);let o=await s.hj();E({type:"USER_STATS_LOADED",payload:o})}catch(e){console.error("Failed to delete set:",e),e instanceof s.lR?(alert(e.message),_()):alert(e.message)}},I=async(e,a)=>{if(m.user)try{let{updatedUser:t,updatedSet:r}=await s.A9(e,a),o=await s.uN(20);E({type:"HISTORY_LOADED",payload:o}),E({type:"UPDATE_USER",payload:t}),r&&E({type:"UPDATE_SET",payload:r});let n=await s.hj();E({type:"USER_STATS_LOADED",payload:n});let l=localStorage.getItem(d)||sessionStorage.getItem(d);if(l){let e=localStorage.getItem(d)?localStorage:sessionStorage,a={...JSON.parse(l),...t};e.setItem(d,JSON.stringify(a))}}catch(e){console.error("Failed to save quiz result:",e),e instanceof s.lR&&(alert(e.message),_())}},L=async(e,a)=>{let t;if(!m.user)return;let r=m.vocabSets.find(a=>a._id===e);if(!r)return;let o=r.items.map(e=>e.id===a?t={...e,needsReview:!e.needsReview}:e);if(!t)return;let n={...r,items:o};try{E({type:"UPDATE_SET",payload:n}),await s.aC(n)}catch(e){console.error("Failed to update 'needs review' status:",e),E({type:"UPDATE_SET",payload:r}),e instanceof s.lR?(alert(e.message),_()):alert("Could not update item. Please try again.")}},N=async e=>{try{return await n.FQ(e)}catch(e){return e instanceof Error&&e.message===n.m7&&E({type:"REQUEST_USER_API_KEY",payload:!0}),null}},P=async(e,a)=>{E({type:"SET_LOADING",payload:!0});try{let t=await n.r(e,a);if(t)return t.map((e,a)=>({...e,id:"ai-".concat(Date.now(),"-").concat(a)}));return null}catch(e){return e instanceof Error&&e.message===n.m7&&E({type:"REQUEST_USER_API_KEY",payload:!0}),console.error("AI set generation failed in context:",e),null}finally{E({type:"SET_LOADING",payload:!1})}},b=(0,o.useCallback)(async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";E({type:"SET_LOADING",payload:!0});try{let t=await s.rK(e,9,a);E({type:"PUBLIC_SETS_LOADED",payload:t})}catch(e){console.error("Failed to fetch public sets:",e),e instanceof s.lR?(alert(e.message),_()):alert(e.message),E({type:"SET_LOADING",payload:!1})}},[_]),v=async e=>{E({type:"SET_LOADING",payload:!0});try{let{newSet:a,updatedUser:t}=await s.QQ(e);await T(1),E({type:"UPDATE_USER",payload:t});let r=await s.hj();E({type:"USER_STATS_LOADED",payload:r});let o=localStorage.getItem(d)||sessionStorage.getItem(d);if(o){let e=localStorage.getItem(d)?localStorage:sessionStorage,a={...JSON.parse(o),...t};e.setItem(d,JSON.stringify(a))}return alert('Set "'.concat(a.title,'" has been added to your collection!')),a}catch(e){console.error("Failed to clone set:",e),e instanceof s.lR?(alert(e.message),_()):alert(e.message)}finally{E({type:"SET_LOADING",payload:!1})}},R=async()=>{if(m.user){E({type:"SET_LOADING",payload:!0});try{let e=await s.uN();E({type:"PROFILE_HISTORY_LOADED",payload:e})}catch(e){console.error("Failed to fetch full history:",e),e instanceof s.lR&&(alert(e.message),_())}}},U=async e=>{if(m.user){E({type:"SET_LOADING",payload:!0});try{let a=await s.eg(e);(localStorage.getItem(d)?localStorage:sessionStorage).setItem(d,JSON.stringify(a)),E({type:"LOGIN",payload:a}),alert("Profile updated successfully!")}catch(e){console.error("Failed to update profile:",e),alert(e.message),E({type:"SET_LOADING",payload:!1})}}},k=(0,o.useCallback)(async()=>{E({type:"SET_LOADING",payload:!0});try{let e=await s.Ee();E({type:"LEADERBOARD_LOADED",payload:e})}catch(e){console.error("Failed to fetch leaderboard:",e),e instanceof s.lR?(alert(e.message),_()):alert("Could not load the leaderboard.")}finally{E({type:"SET_LOADING",payload:!1})}},[_]),C=(0,o.useCallback)(async()=>{var e;if((null==(e=m.user)?void 0:e.role)==="admin"){E({type:"SET_LOADING",payload:!0});try{let e=await s.dE();E({type:"ADMIN_STATS_LOADED",payload:e})}catch(e){console.error("Failed to fetch admin stats:",e),alert("Could not load admin statistics.")}}},[null==(y=m.user)?void 0:y.role]),G=(0,o.useCallback)(async e=>{var a;if((null==(a=m.user)?void 0:a.role)==="admin"){E({type:"SET_LOADING",payload:!0});try{let a=await s.b0(e,10);E({type:"ADMIN_USERS_LOADED",payload:a})}catch(e){console.error("Failed to fetch admin users:",e),alert("Could not load user list.")}}},[null==(p=m.user)?void 0:p.role]),F=(0,o.useCallback)(async e=>{var a,t;if((null==(a=m.user)?void 0:a.role)==="admin"){E({type:"SET_LOADING",payload:!0});try{await s.A3(e),await G((null==(t=m.adminUsersPagination)?void 0:t.currentPage)||1),alert("User deleted successfully.")}catch(e){console.error("Failed to delete user:",e),alert(e.message)}}},[null==(u=m.user)?void 0:u.role,G,null==(g=m.adminUsersPagination)?void 0:g.currentPage]);return(0,o.useEffect)(()=>{m.user&&w()},[null==(S=m.user)?void 0:S.token]),(0,r.jsx)(c.Provider,{value:{state:m,login:f,register:A,logout:_,fetchSets:T,saveSet:D,deleteSet:O,saveQuizResult:I,toggleNeedsReview:L,generateSetWithAI:P,generateExample:N,fetchPublicSets:b,cloneSet:v,closeApiKeyModal:()=>E({type:"REQUEST_USER_API_KEY",payload:!1}),fetchProfileHistory:R,updateUserProfile:U,fetchLeaderboard:k,fetchAdminStats:C,fetchAdminUsers:G,adminDeleteUser:F},children:h})}}}]);