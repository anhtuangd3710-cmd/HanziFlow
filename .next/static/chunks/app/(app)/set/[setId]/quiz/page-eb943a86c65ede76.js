(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[510],{17237:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(95155);r(12115);let s=()=>(0,n.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"})},20063:(e,t,r)=>{"use strict";var n=r(47260);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},34267:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var n=r(95155);r(12115);let s=e=>{let{children:t,size:r=24,className:s="",...i}=e;return(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,...i,children:t})}},41618:(e,t,r)=>{"use strict";r.d(t,{c:()=>i});var n=r(95155);r(12115);var s=r(34267);let i=e=>(0,n.jsxs)(s.z,{...e,children:[(0,n.jsx)("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),(0,n.jsx)("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),(0,n.jsx)("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]})},62759:(e,t,r)=>{Promise.resolve().then(r.bind(r,91278))},91278:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var n=r(95155),s=r(12115),i=r(17237),a=r(20063),l=r(43853),o=r(12083),c=r(37621),u=r(41618);let d={a:{1:"ā",2:"\xe1",3:"ǎ",4:"\xe0",5:"a"},e:{1:"ē",2:"\xe9",3:"ě",4:"\xe8",5:"e"},i:{1:"ī",2:"\xed",3:"ǐ",4:"\xec",5:"i"},o:{1:"ō",2:"\xf3",3:"ǒ",4:"\xf2",5:"o"},u:{1:"ū",2:"\xfa",3:"ǔ",4:"\xf9",5:"u"},ü:{1:"ǖ",2:"ǘ",3:"ǚ",4:"ǜ",5:"\xfc"},v:{1:"ǖ",2:"ǘ",3:"ǚ",4:"ǜ",5:"\xfc"}},m=e=>e.toLowerCase().split(/\s+/).map(e=>(e.match(/([a-züv]+[1-5]?)/g)||[e]).map(e=>{var t;let r=e.match(/^([a-züv]+)([1-5])$/);if(!r)return e;let[,n,s]=r,i=-1;if(n.includes("a")?i=n.indexOf("a"):n.includes("o")?i=n.indexOf("o"):n.includes("e")?i=n.indexOf("e"):n.includes("iu")?i=n.indexOf("u"):n.includes("i")?i=n.indexOf("i"):n.includes("u")?i=n.indexOf("u"):n.includes("\xfc")?i=n.indexOf("\xfc"):n.includes("v")&&(i=n.indexOf("v")),-1===i)return e;let a="v"===n[i]?"v":n[i],l=(null==(t=d[a])?void 0:t[s])||a;return n.substring(0,i)+l+n.substring(i+1)}).join("")).join(" ");function h(e){return[...e].sort(()=>Math.random()-.5)}let x=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sine";try{let n=new(window.AudioContext||window.webkitAudioContext);if(!n)return;let s=n.createOscillator(),i=n.createGain();s.connect(i),i.connect(n.destination),s.type=r,s.frequency.value=e,i.gain.setValueAtTime(0,n.currentTime),i.gain.linearRampToValueAtTime(.3,n.currentTime+.01),s.start(n.currentTime),i.gain.exponentialRampToValueAtTime(1e-5,n.currentTime+t/1e3),s.stop(n.currentTime+t/1e3)}catch(e){console.error("Could not play audio:",e)}},g=()=>{var e;let t=(0,a.useParams)().setId,r=(0,a.useRouter)(),d=(0,a.useSearchParams)(),g=d.get("quizType")||"standard",f=(null==(e=d.get("types"))?void 0:e.split(","))||[],b=parseInt(d.get("questionCount")||"10"),p=(0,s.useContext)(l.B),[w,v]=(0,s.useState)(void 0),[j,y]=(0,s.useState)(!0),[N,A]=(0,s.useState)([]),[C,z]=(0,s.useState)(0),[k,S]=(0,s.useState)(null),[T,P]=(0,s.useState)("");if(!p)return(0,n.jsx)("div",{children:"Loading..."});let{state:L,saveQuizResult:O}=p,R=(0,s.useMemo)(()=>L.vocabSets.find(e=>e._id===t),[L.vocabSets,t]);(0,s.useEffect)(()=>{if(R){v(R),y(!1);return}(async()=>{if(!t){v(null),y(!1);return}y(!0);try{let e=await (0,c.Re)(t);v(e)}catch(e){console.error("Failed to fetch quiz set:",e),v(null)}finally{y(!1)}})()},[t,R]),(0,s.useEffect)(()=>{if(w&&t){let e=w.items;if("review"===g&&(e=w.items.filter(e=>e.needsReview)),e.length<4)return void A([]);let t=b&&b>0?b:e.length;A(h(e).slice(0,t).map(t=>{let r;r=["meaning","hanzi","pinyin"];let n=f&&f.length>0?r.filter(e=>f.includes(e)):r;0===n.length&&(n=r);let s=n[Math.floor(Math.random()*n.length)];switch(s){case"hanzi":{let r=h(e.filter(e=>e.id!==t.id)).slice(0,3).map(e=>e.hanzi),n=h([t.hanzi,...r]);return{type:s,vocabItem:t,options:n,correctAnswer:t.hanzi}}case"pinyin":return{type:s,vocabItem:t,options:[],correctAnswer:t.pinyin};default:{let r=h(e.filter(e=>e.id!==t.id)).slice(0,3).map(e=>e.meaning),n=h([t.meaning,...r]);return{type:s,vocabItem:t,options:n,correctAnswer:t.meaning}}}}))}},[w,g,f,b,t]);let q=e=>{let n=N[C];("pinyin"===n.type?m(e).toLowerCase()===n.correctAnswer.toLowerCase():e===n.correctAnswer)?(x(600,100,"triangle"),setTimeout(()=>x(900,100,"triangle"),120)):x(200,200,"sawtooth");let s=[...N];s[C].userAnswer=e,A(s),S(e),setTimeout(async()=>{if(C<N.length-1)z(C+1),S(null),P("");else{let e={score:s.reduce((e,t)=>t.userAnswer?e+ +!!("pinyin"===t.type?m(t.userAnswer).toLowerCase()===t.correctAnswer.toLowerCase():t.userAnswer===t.correctAnswer):e,0),total:s.length,questions:s};t&&await O(t,e),r.push("/set/".concat(t,"/result"))}},1200)},_=e=>{e.preventDefault(),T.trim()&&!k&&q(T.trim())};if(j)return(0,n.jsxs)("div",{className:"flex justify-center mt-8",children:[(0,n.jsx)(i.A,{})," ",(0,n.jsx)("span",{className:"ml-2",children:"Loading Quiz..."})]});if(!w)return(0,n.jsx)("div",{children:"Set not found."});let E="review"===g?w.items.filter(e=>e.needsReview):w.items;if(E.length<4)return(0,n.jsxs)("div",{className:"text-center p-8 bg-white rounded-lg shadow-md max-w-lg mx-auto",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-700",children:"Not Enough Words"}),(0,n.jsxs)("p",{className:"text-gray-500 mt-2",children:["A quiz needs at least ",4," words.","review"===g?" You currently have ".concat(E.length," word").concat(1===E.length?"":"s"," marked for review."):" This set only has ".concat(E.length," word").concat(1===E.length?"":"s",".")]}),(0,n.jsx)("button",{onClick:()=>r.push("/"),className:"mt-6 py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Dashboard"})]});if(0===N.length)return(0,n.jsxs)("div",{children:[(0,n.jsx)(i.A,{})," Generating questions..."]});let M=N[C];return(0,n.jsxs)("div",{className:"max-w-3xl mx-auto p-4 sm:p-6 bg-white rounded-lg shadow-xl",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold text-gray-800",children:[w.title," ","review"===g?"Review":""," Quiz"]}),(0,n.jsxs)("div",{className:"text-lg font-semibold text-gray-600",children:[" ",C+1," / ",N.length," "]})]}),(0,n.jsx)("div",{className:"bg-gray-100 p-8 rounded-lg text-center mb-6 min-h-[180px] flex flex-col justify-center",children:(()=>{let{type:e,vocabItem:t}=M,r=(0,n.jsxs)("button",{onClick:e=>{var r;e.stopPropagation(),r=t.hanzi,(0,o.AU)(r)},className:"ml-4 p-2 bg-blue-100 text-blue-600 rounded-full hover:bg-blue-200 transition-transform transform hover:scale-110 flex items-center justify-center h-12 w-12","aria-label":"Play pronunciation",children:[" ",(0,n.jsx)(u.c,{size:24})," "]});return"meaning"===e||"pinyin"===e?(0,n.jsxs)("div",{className:"flex items-center justify-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-6xl font-bold",children:t.hanzi}),"meaning"===e&&(0,n.jsx)("p",{className:"text-2xl text-gray-500 mt-2",children:t.pinyin})]}),r]}):"hanzi"===e?(0,n.jsx)("p",{className:"text-4xl font-bold text-center",children:t.meaning}):null})()}),(()=>{if("pinyin"===M.type){let e=!!k,t=e&&m(k).toLowerCase()===M.correctAnswer.toLowerCase();return(0,n.jsxs)("form",{onSubmit:_,children:[(0,n.jsx)("input",{type:"text",value:T,onChange:e=>P(e.target.value),placeholder:"Type the pinyin",disabled:e,className:"w-full p-4 border-2 rounded-lg text-center text-lg transition-all duration-300 ".concat(e?t?"bg-green-200 border-green-500":"bg-red-200 border-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500")}),(0,n.jsx)("button",{type:"submit",disabled:e||!T.trim(),className:"mt-4 w-full p-4 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 disabled:bg-gray-400",children:"Submit"}),e&&!t&&(0,n.jsxs)("p",{className:"text-center mt-2 text-lg text-green-700 font-semibold",children:["Correct answer: ",M.correctAnswer]})]})}let e=(M.options||[]).length>4?"sm:grid-cols-3":"sm:grid-cols-2";return(0,n.jsx)("div",{className:"grid grid-cols-1 ".concat(e," gap-4"),children:(M.options||[]).map((e,t)=>{let r=e===M.correctAnswer,s="p-4 text-left font-semibold rounded-lg border-2 transition-all duration-300";return k===e?s+=r?" bg-green-200 border-green-500 text-green-800":" bg-red-200 border-red-500 text-red-800":k?s+=r?" bg-green-200 border-green-500 text-green-800":" bg-white border-gray-300":s+=" bg-white border-gray-300 hover:bg-blue-50 hover:border-blue-400",(0,n.jsxs)("button",{onClick:()=>q(e),disabled:!!k,className:s,children:[" ",e," "]},t)})})})(),(0,n.jsx)("button",{onClick:()=>r.push("/"),className:"mt-8 block mx-auto text-gray-600 hover:text-gray-800 font-semibold",children:" ← Quit Quiz "})]})};function f(){return(0,n.jsx)(s.Suspense,{fallback:(0,n.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,n.jsx)(i.A,{}),(0,n.jsx)("p",{className:"ml-4 text-gray-600",children:"Loading page..."})]}),children:(0,n.jsx)(g,{})})}}},e=>{e.O(0,[798,853,441,255,358],()=>e(e.s=62759)),_N_E=e.O()}]);